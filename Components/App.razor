<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="barber-website.styles.css" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <HeadOutlet />
</head>

<body class="overflow-x-hidden">
    <Routes />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            const firstSectionVideo = $('#first-vid');
            const slider = $('#slider');
            const slideWidthPercentage = 100 / $('input[name="offer-control"]').length;
            const ofLabel = $('label');
            const offerControls = $('input[name="offer-control"]');
            let vidIndex = 1;
            let vidNow = 1;
            let firstVisible = true;

            offerControls.change(function () {
                const selectedLabel = $(`#l-of-${this.value}`);
                const unselectedLabels = ofLabel.not(selectedLabel);

                selectedLabel.removeClass('w-5').addClass('w-14');
                unselectedLabels.removeClass('w-14').addClass('w-5');

                $('video').each(function () {
                    this.pause();
                });

                $(`#vid${this.value}`)[0].play();

                const n = parseInt(this.value);
                vidIndex = n % 8;
    
                let slidePosition = -slideWidthPercentage * (n - 1);
                $('#slider').css('transform', `translateX(${slidePosition}%)`);
                $('#text-slider').css('transform', `translateX(${slidePosition}%)`);
                timer.reset(10000);
            });

            let timer = new Timer(function () {
                if (!firstVisible) {
                    offerControls.eq(vidIndex).click();
                }
            }, 10000);

            $(window).scroll(function () {
                const firstSectionTop = firstSectionVideo.offset().top;
                const firstSectionBottom = firstSectionTop + firstSectionVideo.height();
                const viewportTop = $(window).scrollTop();
                const viewportBottom = viewportTop + $(window).height();

                const isMoreThanHalfVisible = firstSectionTop < viewportBottom && firstSectionBottom > viewportTop + firstSectionVideo.height() / 2;

                if (isMoreThanHalfVisible) {
                    firstVisible = true;
                    $('video').each(function () {
                        this.pause();
                    });
                    firstSectionVideo[0].play();
                    $('#arrowdown').fadeIn(200);
                    timer.stop();
                } else {
                    firstVisible = false;
                    firstSectionVideo[0].pause();
                    $(`#vid${vidIndex}`)[0].play();
                    $('#arrowdown').fadeOut(200);
                    timer.start();
                }
            });

            function Timer(fn, t) {
                let timerObj = setInterval(fn, t);

                this.stop = function () {
                    if (timerObj) {
                        clearInterval(timerObj);
                        timerObj = null;
                    }
                    return this;
                }

                this.start = function () {
                    if (!timerObj) {
                        this.stop();
                        timerObj = setInterval(fn, t);
                    }
                    return this;
                }

                this.reset = function (newT = t) {
                    t = newT;
                    return this.stop().start();
                }
            }

            $('#offerbtn, #arrowdown').on('click', function () {
                $('html, body').animate({
                    scrollTop: $(document).height()
                }, 500);
            });

            $('#mainbtn').on('click', function () {
                $('html, body').animate({
                    scrollTop: 0
                }, 500);
            });

            $('#nav-booking-btn, #first-booking-btn, #second-booking-btn').on('click', function () {
                window.location.href = '/rezerwacja';
            });
        });
    </script>
    <script src="_framework/blazor.web.js"></script>
</body>

</html>
